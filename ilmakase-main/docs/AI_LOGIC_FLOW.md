# 일마카세 아카이브 - AI 로직 완전 가이드

## 🎯 핵심 컨셉

**"AI가 유사한 업무를 자동으로 묶어서, 능력치별로 카드를 생성한다"**

## 📊 전체 플로우

```
1개 기록 작성
  ↓
✅ AI 즉시 미리보기
  "이렇게 쓸 수 있어요"

3개 기록 쌓임
  ↓
💡 AI 패턴 분석 가능
  "확인하기" 클릭 시 분석

5개 기록 쌓임
  ↓
🎉 프로젝트 발견
  AI가 자동 그룹핑
  ↓
📁 프로젝트 목록 표시
  "신규 마케팅 캠페인" (5개)
  "데이터 분석 시스템" (3개)
  ↓
사용자 선택
  ↓
🎨 카드 생성
  "신규 마케팅 캠페인" 카드
```

## 🧠 AI 그룹핑 로직

### 문제점 (기존)
```typescript
❌ 잘못된 방식:
- 최근 5-10개 기록을 무조건 하나의 카드로
- "마케팅" + "데이터 분석" + "디자인" 전부 섞임
- 의미 없는 카드 생성
```

### 해결책 (개선)
```typescript
✅ AI 자동 그룹핑:
- AI가 기록들을 분석
- 유사한 주제/프로젝트끼리 자동 그룹화
- 각 그룹별로 카드 생성 제안

예시:
기록 12개 →
  그룹 1: "신규 마케팅 캠페인" (5개) → 카드 생성 가능
  그룹 2: "데이터 분석 시스템" (3개) → 대기 (더 쌓을 때까지)
  그룹 3: "디자인 리뉴얼" (4개) → 대기
```

## 🔧 기술 구현

### 1. AI 그룹핑 (grouping.ts)
```typescript
// AI가 기록들을 분석하여 유사한 것끼리 묶기
groupRecordsByTheme(records) → [
  {
    theme: "신규 마케팅 캠페인 기획",
    description: "타겟 분석 및 A/B 테스트 중심",
    record_ids: ["uuid1", "uuid2", "uuid3", "uuid4", "uuid5"],
    confidence: 85  // AI의 확신도
  },
  {
    theme: "데이터 분석 시스템 구축",
    description: "GA4 데이터 파이프라인 구축",
    record_ids: ["uuid6", "uuid7", "uuid8"],
    confidence: 78
  }
]
```

**그룹핑 기준:**
1. 업무의 주제나 목적이 유사한가?
2. 같은 프로젝트나 캠페인의 일부인가?
3. 서로 연관성이 있는 작업인가?

**제약 조건:**
- 최소 3개 이상의 기록만 그룹으로 묶음
- 연관성이 낮으면 그룹에 포함하지 않음
- confidence 70% 이상만 표시

### 2. 프로젝트 페이지 (/projects)
```
AI가 분석한 프로젝트 목록 표시:

┌─────────────────────────────┐
│ 📁 신규 마케팅 캠페인 기획  │
│ 타겟 분석 및 A/B 테스트     │
│ [기록 5개] [확신도 85%]     │
│ [이 프로젝트로 카드 만들기] │
└─────────────────────────────┘

┌─────────────────────────────┐
│ 📁 데이터 분석 시스템 구축  │
│ GA4 데이터 파이프라인       │
│ [기록 3개] [확신도 78%]     │
│ [이 프로젝트로 카드 만들기] │
└─────────────────────────────┘
```

### 3. 카드 생성 API
```typescript
POST /api/cards/generate
Body: {
  record_ids: ["uuid1", "uuid2", ...]  // 그룹의 특정 기록들
}

→ AI가 해당 기록들만으로 카드 생성
→ 프로젝트명, 업무 내용, 사고 방식 추출
```

## 🎨 사용자 경험

### 시나리오 1: 다양한 업무
```
사용자가 10개 기록 작성:
- 마케팅 5개
- 데이터 분석 3개
- 디자인 2개

홈 알림: "프로젝트를 찾았어요!"
  ↓
프로젝트 페이지:
- "신규 마케팅 캠페인" (5개) ✅ 카드 생성 가능
- "데이터 분석 시스템" (3개) ✅ 카드 생성 가능
- 디자인 2개는 그룹 안 됨 (최소 3개 필요)

사용자 선택:
→ "마케팅" 카드 생성
→ "데이터 분석" 카드도 생성 가능
→ 디자인 1개 더 쌓으면 나중에 생성
```

### 시나리오 2: 한 프로젝트에 집중
```
사용자가 8개 기록 작성:
- 전부 "신규 서비스 런칭" 관련

홈 알림: "프로젝트를 찾았어요!"
  ↓
프로젝트 페이지:
- "신규 서비스 런칭" (8개) ✅

사용자 선택:
→ 카드 1개 생성 (8개 기록 모두 포함)
```

## 💡 확장 가능성

### Phase 2: 능력치 태깅
```typescript
그룹별로 능력치 자동 추출:

"신규 마케팅 캠페인" →
  - 데이터 분석 능력 ⭐⭐⭐⭐
  - 전략 기획 능력 ⭐⭐⭐⭐⭐
  - 의사소통 능력 ⭐⭐⭐

"데이터 시스템 구축" →
  - 기술적 이해도 ⭐⭐⭐⭐⭐
  - 문제 해결 능력 ⭐⭐⭐⭐
  - 데이터 분석 능력 ⭐⭐⭐⭐
```

### Phase 3: 수동 조정
- 사용자가 직접 기록을 선택해서 그룹 편집
- 그룹 병합/분리
- 능력치 수동 조정

## 🔄 기존 로직과의 차이

### 기존 (단순)
```
5개 쌓임 → 최근 5개로 카드 1개
10개 쌓임 → 최근 10개로 카드 1개
15개 쌓임 → 최근 10개로 카드 1개, 5개 남음
```

### 신규 (AI 그룹핑)
```
5개 쌓임 → AI 분석 → 그룹별 카드 제안
10개 쌓임 → AI 분석 → 여러 프로젝트 발견 → 선택
15개 쌓임 → AI 분석 → 3-4개 프로젝트 → 원하는 것만 카드로
```

## 🚀 구현 상태

- ✅ Gemini 모델 수정 (`gemini-1.5-flash-latest`)
- ✅ AI 그룹핑 로직 (`lib/gemini/grouping.ts`)
- ✅ 그룹핑 API (`/api/ai/group`)
- ✅ 프로젝트 페이지 (`/projects`)
- ✅ 카드 생성 API 개선 (특정 record_ids 지원)
- ✅ 홈 알림 개선

## 📱 새로운 화면 구조

```
홈
 ├─ 알림: "프로젝트를 찾았어요!"
 └─ [프로젝트 보기] 버튼
      ↓
프로젝트 페이지
 ├─ AI가 찾은 프로젝트 목록
 ├─ 각 프로젝트: 제목, 설명, 기록 개수, 확신도
 └─ [이 프로젝트로 카드 만들기] 버튼
      ↓
카드 생성 → 카드 상세 페이지
```

